import semver from 'semver'

export const filterRelatedVulnerabilities = (node: INode, vulnerabilities: ISecurityVulnerability[]) => {
  let relatedAdvisories: ISecurityVulnerability[] = []

  relatedAdvisories = vulnerabilities.filter((vulnerability) => {
    if (node.version !== 'latest') {
      const versionRange = vulnerability.vulnerableVersionRange && vulnerability.vulnerableVersionRange.toString().replace(',', '')
      // console.log('range:', versionRange, 'version:', node.version)

      if (semver.intersects(node.version, versionRange)) {
        return true
      }
    }

    return false
  })

  return relatedAdvisories
}